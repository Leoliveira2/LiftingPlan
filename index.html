<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LiftingPlanMonitor — Versão Revertida (Sem Zonas)</title>
<style>
  :root{
    --bg:#0b1220; --panel:#121a2b; --line:#1f2a44; --txt:#eaf0ff; --muted:#9db0c9;
    --accent:#60a5fa; --ok:#22c55e; --bad:#ef4444;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:Inter, system-ui, Segoe UI, Roboto, Arial, Helvetica, sans-serif;
       background:linear-gradient(180deg,#0b1220,#0d1628 40%,#0b1220); color:var(--txt)}
  .wrap{max-width:1100px; margin:auto; padding:24px}
  h1{font-size:20px; margin:0 0 12px}
  .grid{display:grid; gap:16px; grid-template-columns:1.2fr .8fr}
  .card{background:var(--panel); border:1px solid var(--line); border-radius:16px; padding:16px; box-shadow:0 6px 24px rgba(0,0,0,.25)}
  label{font-size:12px; color:var(--muted)}
  .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  .row3{display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px}
  .input{display:flex; flex-direction:column; gap:6px}
  input[type="number"], input[type="range"]{
    width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--line);
    background:#0f1729; color:var(--txt); outline:none
  }
  input[type="range"]{height:36px}
  canvas{width:100%; height:520px; background:radial-gradient(1200px 520px at 50% 100%, #0a1222 0,#0b1120 60%, #09101d 100%);
         border-radius:12px; border:1px solid var(--line)}
  .subtitle{font-size:12px; color:var(--muted); margin-top:6px}
  .status{display:flex; gap:10px; align-items:center; margin-top:10px}
  .pill{padding:6px 10px; border-radius:999px; font-weight:600; font-size:12px;
        border:1px solid rgba(255,255,255,.12); display:inline-flex; align-items:center}
  .pill.ok{background:rgba(34,197,94,.12); color:#b7f7cb}
  .pill.bad{background:rgba(239,68,68,.12); color:#ffc7c7}
  .kpi{display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:12px}
  .k{background:#0f1729; border:1px solid var(--line); border-radius:12px; padding:10px}
  .k h3{margin:0; font-size:12px; color:var(--muted)}
  .k p{margin:6px 0 0; font-size:18px}
  .foot{font-size:11px; color:var(--muted); margin-top:10px}
  .btn{cursor:pointer; padding:10px 12px; border-radius:10px; border:1px solid var(--line);
       background:#0f1729; color:var(--txt)}
  @media (max-width:980px){ .grid{grid-template-columns:1fr} }
</style>
</head>
<body>
  <div class="wrap">
    <h1>LiftingPlanMonitor — Versão Revertida (sem zonas de cores)</h1>
    <div class="grid">
      <div class="card">
        <canvas id="scene" width="900" height="520"></canvas>
        <div class="subtitle">
          Visualização da lança em cor única. O status operacional é calculado por <b>carga</b> ÷ <b>capacidade no raio</b>.
        </div>
      </div>

      <div class="card">
        <h1>Parâmetros</h1>

        <div class="row">
          <div class="input">
            <label>Carga suspensa (t)</label>
            <input type="number" id="load" min="0" step="0.1" value="10">
          </div>
          <div class="input">
            <label>Capacidade no raio atual (t) <span style="color:var(--muted)">(tabela do fabricante)</span></label>
            <input type="number" id="capacity" min="0" step="0.1" value="14">
          </div>
        </div>

        <div class="row3" style="margin-top:10px">
          <div class="input">
            <label>Ângulo da lança (°)</label>
            <input type="range" id="angle" min="20" max="80" step="1" value="55">
          </div>
          <div class="input">
            <label>Raio (m)</label>
            <input type="range" id="radius" min="5" max="60" step="1" value="24">
          </div>
          <div class="input">
            <label>Comprimento da lança (m)</label>
            <input type="range" id="boomLen" min="20" max="70" step="1" value="42">
          </div>
        </div>

        <div class="status">
          <span id="statusPill" class="pill">Status</span>
          <button id="reset" class="btn" title="Resetar valores">Resetar</button>
        </div>

        <div class="kpi">
          <div class="k"><h3>Utilização</h3><p id="kUtil">—</p></div>
          <div class="k"><h3>Margem</h3><p id="kMarg">—</p></div>
          <div class="k"><h3>Capacidade @raio</h3><p id="kCap">—</p></div>
        </div>

        <div class="foot">
          *Informe a capacidade <b>no raio</b> a partir da tabela oficial do fabricante (ex.: Liebherr LTM 1220-5.2).
          Esta versão não aplica política de 75–80% nem altera a cor da lança.
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);
  const state = {
    load: $('load'),
    capacity: $('capacity'),
    angle: $('angle'),
    radius: $('radius'),
    boomLen: $('boomLen'),
    pill: $('statusPill'),
    kUtil: $('kUtil'),
    kMarg: $('kMarg'),
    kCap:  $('kCap'),
    reset: $('reset'),
    canvas: $('scene'),
    ctx: $('scene').getContext('2d'),
  };

  function compute(){
    const load = parseFloat(state.load.value||0);
    const cap  = Math.max(0.0001, parseFloat(state.capacity.value||0));
    const util = load / cap;                 // fração
    const margin = Math.max(0, cap - load);  // t
    const allowed = util < 1.0;              // permitido se abaixo de 100% da curva
    return {load, cap, util, margin, allowed};
  }

  function draw(){
    const {ctx, canvas} = state;
    const ang  = parseFloat(state.angle.value)*Math.PI/180;
    const boom = parseFloat(state.boomLen.value);

    const {load, cap, util, margin, allowed} = compute();

    ctx.clearRect(0,0,canvas.width,canvas.height);

    // chão
    ctx.fillStyle = '#0c1426';
    ctx.fillRect(0, 430, canvas.width, 90);
    ctx.strokeStyle = '#1f2a44';
    ctx.beginPath();
    for(let x=0;x<canvas.width;x+=26){ ctx.moveTo(x,430); ctx.lineTo(x+10,430); }
    ctx.stroke();

    // Base do guindaste
    const baseX = 140, baseY = 420;
    ctx.fillStyle = '#1b2742';
    ctx.fillRect(baseX-40, baseY-30, 80, 30);
    ctx.fillStyle = '#223355';
    ctx.fillRect(baseX-22, baseY-60, 44, 30);

    // Lança (cor fixa, sem zonas)
    const lenPx = boom*7; // escala simples
    const endX = baseX + lenPx * Math.cos(Math.PI/2 - ang);
    const endY = baseY - lenPx * Math.sin(Math.PI/2 - ang);

    ctx.strokeStyle = '#60a5fa'; // cor única
    ctx.lineWidth = 10; ctx.lineCap = 'round';
    ctx.beginPath(); ctx.moveTo(baseX, baseY-60); ctx.lineTo(endX, endY); ctx.stroke();

    // Gancho e carga
    ctx.fillStyle = '#9fb5ff';
    ctx.beginPath(); ctx.arc(endX, endY, 6, 0, Math.PI*2); ctx.fill();
    ctx.strokeStyle = '#9fb5ff'; ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(endX, endY); ctx.lineTo(endX, endY+40); ctx.stroke();
    ctx.fillStyle = '#adb8cc'; ctx.fillRect(endX-12, endY+40, 24, 26);

    // Indicativos de texto
    ctx.font = '12px Inter, system-ui, sans-serif';
    ctx.fillStyle = '#cfe3ff';
    ctx.fillText(`Carga: ${load.toFixed(1)} t`, endX+10, endY+10);
    ctx.fillText(`Capacidade@raio: ${cap.toFixed(1)} t`, endX+10, endY+26);
    ctx.fillText(`Utilização: ${(util*100).toFixed(0)}%`, endX+10, endY+42);

    // Status (apenas por capacidade)
    updateStatus(allowed);

    // KPIs
    state.kUtil.textContent = (util*100).toFixed(1) + '%';
    state.kMarg.textContent = margin.toFixed(1) + ' t';
    state.kCap.textContent  = cap.toFixed(1) + ' t';
  }

  function updateStatus(allowed){
    const p = state.pill;
    p.className = 'pill ' + (allowed ? 'ok' : 'bad');
    p.textContent = allowed ? 'PERMITIDO — abaixo da curva do fabricante'
                            : 'NÃO PERMITIDO — excede a curva do fabricante';
  }

  ['load','capacity','angle','radius','boomLen'].forEach(id=>{
    state[id].addEventListener('input', draw);
  });

  state.reset.addEventListener('click', ()=>{
    state.load.value = 10;
    state.capacity.value = 14;
    state.angle.value = 55;
    state.radius.value = 24;
    state.boomLen.value = 42;
    draw();
  });

  draw();
})();
</script>
</body>
</html>
