<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>LiftingPlanMonitor — Versão 2.0 (Com Zonas de Risco)</title>
<style>
  :root{
    --bg:#0b1220; --panel:#121a2b; --line:#1f2a44; --txt:#eaf0ff; --muted:#9db0c9;
    --accent:#60a5fa; --ok:#22c55e; --attention:#f59e0b; --warn:#ef4444; --bad:#dc2626;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:Inter, system-ui, Segoe UI, Roboto, Arial, Helvetica, sans-serif;
       background:linear-gradient(180deg,#0b1220,#0d1628 40%,#0b1220); color:var(--txt)}
  .wrap{max-width:1100px; margin:auto; padding:24px}
  h1{font-size:20px; margin:0 0 12px}
  .grid{display:grid; gap:16px; grid-template-columns:1.2fr .8fr}
  .card{background:var(--panel); border:1px solid var(--line); border-radius:16px; padding:16px; box-shadow:0 6px 24px rgba(0,0,0,.25)}
  label{font-size:12px; color:var(--muted)}
  .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  .row3{display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px}
  .input{display:flex; flex-direction:column; gap:6px}
  input[type="number"], input[type="range"]{
    width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--line);
    background:#0f1729; color:var(--txt); outline:none
  }
  input[type="range"]{height:36px}
  canvas{width:100%; height:520px; background:radial-gradient(1200px 520px at 50% 100%, #0a1222 0,#0b1120 60%, #09101d 100%);
         border-radius:12px; border:1px solid var(--line)}
  .subtitle{font-size:12px; color:var(--muted); margin-top:6px}
  .status{display:flex; gap:10px; align-items:center; margin-top:10px}
  .pill{padding:6px 10px; border-radius:999px; font-weight:600; font-size:12px;
        border:1px solid rgba(255,255,255,.12); display:inline-flex; align-items:center}
  .pill.ok{background:rgba(34,197,94,.12); color:#b7f7cb}
  .pill.attention{background:rgba(255,204,0,.12); color:#ffcc00}
  .pill.warn{background:rgba(245,158,11,.12); color:#fcd34d}
  .pill.bad{background:rgba(220,38,38,.12); color:#fca5a5}
  .pill.bad{background:rgba(239,68,68,.12); color:#ffc7c7}
  .kpi{display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:12px}
  .k{background:#0f1729; border:1px solid var(--line); border-radius:12px; padding:10px}
  .k h3{margin:0; font-size:12px; color:var(--muted)}
  .k p{margin:6px 0 0; font-size:18px}
  .foot{font-size:11px; color:var(--muted); margin-top:10px}
  .btn{cursor:pointer; padding:10px 12px; border-radius:10px; border:1px solid var(--line);
       background:#0f1729; color:var(--txt)}
  @media (max-width:980px){ .grid{grid-template-columns:1fr} }
</style>
</head>
<body>
	<div class="wrap">
    <h1>LiftingPlanMonitor — Versão 2.0 (Com Zonas de Risco)</h1>
    <div class="grid">
      <div class="card">
        <canvas id="scene" width="900" height="520"></canvas>
        <div class="subtitle">
          Visualização da lança em cor única. O status operacional é calculado por <b>carga</b> ÷ <b>capacidade no raio</b>.
        </div>
      </div>

      <div class="card">
        <h1>Parâmetros</h1>

        <div class="row">
          <div class="input">
            <label>Carga suspensa (t)</label>
            <input type="number" id="load" min="0" step="0.1" value="10">
          </div>
          <div class="input">
            <label>Capacidade no raio atual (t) <span style="color:var(--muted)">(tabela do fabricante)</span></label>
            <input type="number" id="capacity" min="0" step="0.1" value="14">
          </div>
        </div>

	        <div class="row3" style="margin-top:10px">
	          <div class="input">
	            <label>Distância da Linha de Energia (m) <span id="powerDistVal">15</span></label>
	            <input type="range" id="powerDist" min="0" max="30" step="1" value="15">
	          </div>
	          <div class="input">
	            <label>Ângulo da lança (°) <span id="angleVal">55</span></label>
	            <input type="range" id="angle" min="20" max="80" step="1" value="55">
	          </div>
	          <div class="input">
	            <label>Raio (m) <span id="radiusVal">24</span></label>
	            <input type="range" id="radius" min="5" max="60" step="1" value="24">
	          </div>
	        </div>
	        <div class="row3" style="margin-top:10px">
	          <div class="input">
	            <label>Comprimento da lança (m) <span id="boomLenVal">42</span></label>
	            <input type="range" id="boomLen" min="20" max="70" step="1" value="42">
	          </div>
	        </div>

	        <div class="status">
	          <span id="statusPill" class="pill">Status de Carga</span>
	          <span id="powerPill" class="pill">Risco Elétrico</span>
          <button id="reset" class="btn" title="Resetar valores">Resetar</button>
        </div>

		        <div class="kpi">
		          <div class="k"><h3>Utilização</h3><p id="kUtil">—</p></div>
		          <div class="k"><h3>Margem</h3><p id="kMarg">—</p></div>
		          <div class="k"><h3>Capacidade @raio</h3><p id="kCap">—</p></div>
		          <div class="k"><h3>Risco Elétrico</h3><p id="kPowerRisk">—</p></div>
		        </div>
		        <div class="foot">
          *Informe a capacidade <b>no raio</b> a partir da tabela oficial do fabricante (ex.: Liebherr LTM 1220-5.2).
	*A política de Zonas de Risco (80%, 90%, 100%) está ativa e a cor da lança é alterada dinamicamente.
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);
    const state = {
    angleVal: $('angleVal'),
    radiusVal: $('radiusVal'),
    boomLenVal: $('boomLenVal'),
    powerDist: $('powerDist'),
    powerDistVal: $('powerDistVal'),
    powerPill: $('powerPill'),
    kPowerRisk: $('kPowerRisk'),
    load: $('load'),
    capacity: $('capacity'),
    angle: $('angle'),
    radius: $('radius'),
    boomLen: $('boomLen'),
    pill: $('statusPill'),
    kUtil: $('kUtil'),
    kMarg: $('kMarg'),
    kCap:  $('kCap'),
    reset: $('reset'),
    canvas: $('scene'),
    ctx: $('scene').getContext('2d'),
  };

  function compute(){
    const load = parseFloat(state.load.value||0);
    const cap  = Math.max(0.0001, parseFloat(state.capacity.value||0));
    const util = load / cap;                 // fração
    let zone = 'ok';
    let zoneText = 'PERMITIDO - Abaixo de 80% da capacidade.';

    if (util >= 0.8 && util < 0.9) {
      zone = 'attention';
      zoneText = 'ATENÇÃO - Entre 80% e 90% da capacidade.';
    } else if (util >= 0.9 && util <= 1.0) {
      zone = 'warn';
      zoneText = 'CRÍTICO - Entre 90% e 100% da capacidade.';
    } else if (util > 1.0) {
      zone = 'bad';
      zoneText = 'NÃO PERMITIDO - Excede a capacidade.';
    }

    const margin = Math.max(0, cap - load);  // t
    const allowed = util <= 1.0;              // permitido se abaixo de 100% da curva
    return {load, cap, util, margin, allowed, zone, zoneText};
  }

  function draw(){
    const {ctx, canvas} = state;
    const ang  = parseFloat(state.angle.value)*Math.PI/180;
    const boom = parseFloat(state.boomLen.value);

    const {load, cap, util, margin, allowed, zone, zoneText} = compute();
    const {powerZone, powerZoneText} = computePowerRisk();

    // Atualiza valores dos sliders
    state.angleVal.textContent = state.angle.value;
    state.radiusVal.textContent = state.radius.value;
    state.boomLenVal.textContent = state.boomLen.value;
    state.powerDistVal.textContent = state.powerDist.value;

    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Variáveis para o Risco Elétrico
    const powerDist = parseFloat(state.powerDist.value);
    const radius = parseFloat(state.radius.value);
    const MAD = 6; // Mínima Distância de Aproximação (6m, conservador)
    const scale = 7; // Escala de conversão (m para px)
    const powerLineX = baseX + powerDist * scale;
    const powerLineY = 100; // Altura da linha de energia
    const safeZoneX = powerLineX - MAD * scale;

    // Desenha a Zona de Risco Elétrico (MAD)
    ctx.fillStyle = 'rgba(255, 0, 0, 0.1)';
    ctx.fillRect(safeZoneX, 0, MAD * scale, canvas.height);

    // Desenha a Linha de Energia
    ctx.strokeStyle = '#ffcc00';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(powerLineX, 0);
    ctx.lineTo(powerLineX, canvas.height);
    ctx.stroke();
    ctx.fillStyle = '#ffcc00';
    ctx.beginPath();
    ctx.arc(powerLineX, powerLineY, 5, 0, Math.PI*2);
    ctx.fill();
    ctx.font = '12px Inter, system-ui, sans-serif';
    ctx.fillText(`Linha de Energia (${powerDist}m)`, powerLineX + 10, powerLineY);

    // chão
    ctx.fillStyle = '#0c1426';
    ctx.fillRect(0, 430, canvas.width, 90);
    ctx.strokeStyle = '#1f2a44';
    ctx.beginPath();
    for(let x=0;x<canvas.width;x+=26){ ctx.moveTo(x,430); ctx.lineTo(x+10,430); }
    ctx.stroke();

    // Base do guindaste
    const baseX = 140, baseY = 420;
    ctx.fillStyle = '#1b2742';
    ctx.fillRect(baseX-40, baseY-30, 80, 30);
    ctx.fillStyle = '#223355';
    ctx.fillRect(baseX-22, baseY-60, 44, 30);

    // Lança (colorida por zona de risco)
    const lenPx = boom*7; // escala simples
    const endX = baseX + lenPx * Math.cos(Math.PI/2 - ang);
    const endY = baseY - lenPx * Math.sin(Math.PI/2 - ang);

    const boomColor = {
      ok: '#22c55e',
      attention: '#f59e0b',
      warn: '#ef4444',
      bad: '#dc2626'
    }[zone] || '#60a5fa';
    ctx.strokeStyle = boomColor;
    ctx.lineWidth = 10; ctx.lineCap = 'round';
    ctx.beginPath(); ctx.moveTo(baseX, baseY-60); ctx.lineTo(endX, endY); ctx.stroke();

    // Gancho e carga
    ctx.fillStyle = '#9fb5ff';
    ctx.beginPath(); ctx.arc(endX, endY, 6, 0, Math.PI*2); ctx.fill();
    ctx.strokeStyle = '#9fb5ff'; ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(endX, endY); ctx.lineTo(endX, endY+40); ctx.stroke();
    ctx.fillStyle = '#adb8cc'; ctx.fillRect(endX-12, endY+40, 24, 26);

    // Indicativos de texto
    ctx.font = '12px Inter, system-ui, sans-serif';
    ctx.fillStyle = '#cfe3ff';
    ctx.fillText(`Carga: ${load.toFixed(1)} t`, endX+10, endY+10);
    ctx.fillText(`Capacidade@raio: ${cap.toFixed(1)} t`, endX+10, endY+26);
    ctx.fillText(`Utilização: ${(util*100).toFixed(0)}%`, endX+10, endY+42);

    // Status (por zona de risco de carga)
    updateStatus(state.pill, zone, zoneText);

    // Status (por zona de risco elétrico)
    updateStatus(state.powerPill, powerZone, powerZoneText);


    state.kPowerRisk.textContent = powerZoneText;

  }

  function updateStatus(pill, zone, text){
    pill.className = 'pill ' + zone;
    pill.textContent = text;
  }

  function computePowerRisk(){
    const powerDist = parseFloat(state.powerDist.value);
    const radius = parseFloat(state.radius.value);
    const MAD = 6; // Mínima Distância de Aproximação (6m)

    let powerZone = 'ok';
    let powerZoneText = 'SEGURO - Distância > 6m.';

    // O risco é se o raio de operação (horizontal reach) estiver dentro da MAD da linha de energia.
    // Assumindo que a linha de energia está à direita do guindaste.
    const distanceToLine = Math.abs(powerDist - radius);

    if (distanceToLine < MAD) {
      powerZone = 'bad';
      powerZoneText = `NÃO PERMITIDO - Distância (${distanceToLine.toFixed(1)}m) < MAD (${MAD}m).`;
    } else if (distanceToLine < MAD + 5) { // Zona de atenção, 5m além da MAD
      powerZone = 'attention';
      powerZoneText = `ATENÇÃO - Próximo à MAD (${distanceToLine.toFixed(1)}m).`;
    }

    return {powerZone, powerZoneText};
  }

  ['load','capacity','angle','radius','boomLen','powerDist'].forEach(id=>{
    state[id].addEventListener('input', draw);
  });

  state.reset.addEventListener('click', ()=>{
    state.load.value = 10;
    state.capacity.value = 14;
    state.angle.value = 55;
    state.radius.value = 24;
    state.boomLen.value = 42;
    state.powerDist.value = 15;
    draw();
  });

  draw();
})();
</script>
</body>
</html>
